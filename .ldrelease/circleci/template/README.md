## .NET Windows project template

This is for a .NET project (or multi-project solution) that is built with the `dotnet` command on Windows and published to NuGet. You must use this with a Windows CI host.

Example usage in `.ldrelease/config.yml`:

```yaml
circleci:
  windows: {}

template:
  name: dotnet-windows
  env:
    LD_RELEASE_DOCS_ASSEMBLIES: LaunchDarkly.ServerSdk LaunchDarkly.CommonSdk
```

It implements these release steps:

* `update-version`: Updates the version string in `gradle.properties`.
* `build`: Builds all of the projects in `src` in Debug configuration. See "Source file layout". The project must not try to do any code signing when built in Debug configuration.
* `build-docs`:
  * _If_ you set `documentation.title` in your configuration, builds HTML documentation with Sandcastle Help File Builder.
  * This will be uploaded to Github Pages if you also set `documentation.githubPages` to true. Even if you don't, an archive of the docs will be published as a Github release asset.
  * If the docs should be based on a build that is not for the `net45` target framework, set `template.env.LD_RELEASE_DOCS_TARGET_FRAMEWORK` to the desired target framework.
  * If the docs should include XML comments from another assembly that is not in this project, but is a dependency, set `template.env.LD_RELEASE_DOCS_ASSEMBLIES` to a space-delimited list of all the assemblies that should be documented. By default, this is just the list of assemblies generated by the projects in `src`.
* `test`: Builds and runs all of the test projects in `test`. They are run with `net45` as a target framework, unless you specify a different target framework in `template.env.LD_RELEASE_TEST_TARGET_FRAMEWORK`.
* `publish`:
  * Rebuilds all of the projects in `src` in Release configuration.
  * Signs the assemblies _unless_ you set `template.env.LD_RELEASE_SKIP_SIGNING` (see "Code signing" below).
  * Publishes each package to NuGet.

### Source file layout

The source code must be structured as follows:

* `./`: a single `.sln` solution file
* `./src/ProjectName`: one subdirectory in `src` for each project, each of which will be published separately to NuGet; each contains a `ProjectName.csproj`; ProjectName is also the assembly/package name
* `./test/TestProjectName`: one subdirectory in `test` for each unit test project

### CircleCI configuration

The CircleCI project must be configured with the AWS credentials that we use for CircleCI jobs.

### Code signing

The default behavior is to apply Authenticode signing to all of the built assemblies, using the `catamorphic_code_signing_certificate.p12` certificate that we keep in AWS, whose password is also in AWS (see "AWS resources used"). This code-signing step is skipped if you set `LD_RELEASE_SKIP_SIGNING` to a non-empty value.

Projects _may_ also be strong-named, which is a different and weaker form of signing. _If_ a project has an `<AssemblyOriginatorKeyFile>` property, then the publish script will take the base filename of that file path and try to download a key file with the same name from S3. The project should be configured so that it only applies strong-naming when built in the Release configuration.

### AWS resources used

* NuGet API key, from SSM parameter store: `/production/common/services/nuget/api_key`
* Strong-naming key file, from S3: `launchdarkly-pastebin/ci/dotnet/` plus whatever key filename is specified in the `.csproj` file
* Code-signing certificate, from S3: `launchdarkly-pastebin/ci/dotnet/catamorphic_code_signing_certificate.p12`
* Code-signing certificate password, from SSM parameter store: `/production/common/security/ssl-certificates/code-signing/password`
